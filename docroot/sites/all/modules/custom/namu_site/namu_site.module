<?php

/**
 * Implements hook_block_info()
 */
function namu_site_block_info() {
  $blocks['footer'] = array(
    'info' => t('Site Footer'),
  );
  
  $blocks['twitter_placeholder'] = array(
    'info' => t('Twitter Placeholder'),
  );
  
  return $blocks;
}

/**
 * Implements hook_block_configure()
 */
function namu_site_block_configure($delta = '') {
  $form = array();
  
  switch ($delta) {
    case 'footer': {
      $form['footer_text'] = array(
        '#type' => 'textfield',
        '#title' => t('Copyright Text'),
        '#description' => t('Enter text to display to the right of the copyright symbol and year.'),
        '#default_value' => variable_get('namu_site_footer_text', 'North American Marine Underwriters Inc. All Rights Reserved'),
      );
    }
    
    case 'twitter_placeholder': {
      $form['twitter_count'] = array(
        '#type' => 'select',
        '#title' => t('Number of Twitter Items to Display'),
        '#description' => t('Select a number to change the amount of twitter items displayed.'),
        '#options' => array(),
        '#default_value' => variable_get('namu_site_twitter_count', 3),
      );
      
      for ($i = 1; $i <= 20; $i++) {
        $form['twitter_count']['#options'][$i] = $i;
      } 
    }
  }
  
  return $form;
}

/**
 * Implements hook_block_save()
 */
function namu_site_block_save($delta = '', $edit = array()) {
  switch ($delta) {
    case 'footer': {
      if (!empty($edit['footer_text'])) {
        variable_set('namu_site_footer_text', $edit['footer_copy']);
      }
    }
    
    case 'twitter_placeholder': {
      if (!empty($edit['twitter_count'])) {
        variable_set('namu_site_twitter_count', $edit['twitter_count']);
      }
    }
  }
}

/**
 * Implements hook_block_view()
 */
function namu_site_block_view($delta = '') {
  $block = array();
  
  switch ($delta) {
    case 'footer': {
      $footer_text = variable_get('namu_site_footer_text', 'North American Marine Underwriters Inc. All Rights Reserved');
      
      $block['subject'] = '';
      $block['content'] = array(
        '#markup' => '&copy; ' . date('Y') . $footer_text,
        '#prefix' => '<p>',
        '#suffix' => '</p>',
      );
      
      break;
    }
    case 'twitter_placeholder': {
      $block['subject'] = t('Latest News');
      
      $block['content'] = '<ul class="twitter-feed">';
      
      $twitter_count = variable_get('namu_site_twitter_count', 3);
      
      for ($i = 0; $i < $twitter_count; $i++) {
        $block['content'] .=
          '<li>' . "\n" .
            '<a class="tweet-at" href="#">@NAMU</a> ' .
            '<span class="tweet-copy">' .
              t('Sample tweet will be displayed here') .
            '</span> ' .
            '<span class="twitter-date">' .
              t('December 12, 2013') .
            '</span>' .
          '</li>';
      }
      
      $block['content'] .= '</ul>';
      
      break;
    }
  }
  
  return $block;
}
